{{- define "env0-agent.persistent-volume-claim-test.commands" -}}
# Test that the volume is properly mounted
if [ -d "{{ .Values.stateMountPath }}" ]; then
  echo "âœ…ğŸ’¾ Persistent volume claim mounted successfully at {{ .Values.stateMountPath }}"
  echo "âœ…ğŸ’¾ Shared volume mounted successfully at /mnt/shared"
  exit 0
else
  echo "âŒ Persistent volume claim not mounted at {{ .Values.stateMountPath }}"
  exit 1
fi
{{- end -}}

{{- if eq (include "env0-agent.shouldUsePVC" .) "true" }}
{{- include "env0-agent.test" (dict "root" . "testName" "persistent-volume-claim" "commands" "env0-agent.persistent-volume-claim-test.commands" "persistentVolumeClaim" true) -}}
{{- else }}
{{- /* This is a no-op test when PVC is not enabled */ -}}
{{- printf "---\n# Skipping PVC test as shouldUsePVC is false" | nindent 0 }}
{{- end -}}
